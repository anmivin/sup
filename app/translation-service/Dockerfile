FROM node:18

ARG API_HOST
ARG PORT
ARG ROUTES_PREFIX

ARG DB_USERNAME
ARG DB_PASSWORD
ARG DB_DATABASE
ARG DB_HOST
ARG DB_PORT
ARG DB_DIALECT

ENV API_HOST=${API_HOST}
ENV PORT=${PORT}
ENV ROUTES_PREFIX=${ROUTES_PREFIX}

ENV DB_USERNAME=${DB_USERNAME}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV DB_DATABASE=${DB_DATABASE}
ENV DB_HOST=${DB_HOST}
ENV DB_PORT=${DB_PORT}
ENV DB_DIALECT=${DB_DIALECT}

WORKDIR /translation

COPY package*.json ./
COPY ../../backend-shared ./backend-shared

RUN npm ci

COPY . ./app/translation-service

RUN npm run migration:run

EXPOSE 3002

CMD ["npm", "run", "start"]